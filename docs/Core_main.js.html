<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Core/main.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Core/main.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var scHelper = null;
var scKeynodes = null;

/**
 * @Class
 */
SCWeb.core.Main = {

    /**
     * Window types
     * @type {Array}
     * @private
     */
    window_types: [],

    /**
     * Idtf modes
     * @type {Array}
     * @private
     */
    idtf_modes: [],

    /**
     * Menu commands
     * @type {Object}
     * @private
     */
    menu_commands: {},

    /**
     * Default cmd string
     * @type {String}
     * @private
     */
    default_cmd_str: "ui_menu_view_full_semantic_neighborhood",
    
    /**
     * Initialize sc-web core and ui
     * @param {Object} params Initialization parameters.
     * There are required parameters:
     * @param params.menu_container_id Id of dom element, that will contains menu items
     */
    init: function(params) {
        var dfd = new jQuery.Deferred();
        var self = this;
        //SCWeb.ui.Locker.show();

        SCWeb.core.Server._initialize();
        SctpClientCreate().done(function(client) {
        
            window.sctpClient = client;
            window.scHelper = new ScHelper(window.sctpClient);
            window.scKeynodes = new ScKeynodes(window.scHelper);

            window.scKeynodes.init().done(function() {
                window.scHelper.init().done(function() {

                    if (window._unit_tests)
                        window._unit_tests();

                    $.when(SCWeb.ui.TaskPanel.init()).done(function() {
                        SCWeb.core.Server.init(function(data) {
                            self.menu_commands = data.menu_commands;
                            self.user = data.user;

                            data.menu_container_id = params.menu_container_id;

                            SCWeb.core.Translation.fireLanguageChanged(self.user.current_lang);

                            $.when(SCWeb.ui.Core.init(data),
                                SCWeb.core.ComponentManager.init(),
                                SCWeb.core.Translation.update()
                                )
                            .done(function() {
                                    dfd.resolve();

                                    var url = parseURL(window.location.href);

                                    if (url.searchObject) {
                                        var question = url.searchObject['question'];
                                        if (question) {
                                            /// @todo Check question is realy a question
                                            SCWeb.ui.WindowManager.appendHistoryItem(question);
                                            return;
                                        }
                                    }

                                    SCWeb.core.Server.resolveScAddr(['ui_start_sc_element'], function(addrs) {
                                        
                                        function start(a) {
                                            SCWeb.core.Main.doDefaultCommand([a]);
                                            if (params.first_time)
                                                $('#help-modal').modal({"keyboard": true});
                                        }
                                        
                                        var argumentAddr = addrs['ui_start_sc_element'];
                                        window.sctpClient.iterate_elements(SctpIteratorType.SCTP_ITERATOR_3F_A_A, [argumentAddr, sc_type_arc_pos_const_perm, 0])
                                        .done(function(res) {
                                            start(res[0][2]);
                                        }).fail(function() {
                                            start(argumentAddr);
                                        });
                                        
                                    });
                            });
                        });
                    });
                });

            });
        });

        return dfd.promise();
    },

    _initUI: function() {

    },
    
    /**
     * Get default external language
     * @returns {String} sc-addr of preferred output language for current user
     */
    getDefaultExternalLang: function() {
        return this.user.default_ext_lang;
    },
    
    /**
     * Initiate user interface command
     * @param {String} cmd_addr sc-addr of user command
     * @param {Array} cmd_args Array of sc-addrs with command arguments
     */
    doCommand: function(cmd_addr, cmd_args) {
        SCWeb.core.Arguments.clear();
        SCWeb.core.Server.doCommand(cmd_addr, cmd_args, function(result) {
            if (result.question != undefined) {
                SCWeb.ui.WindowManager.appendHistoryItem(result.question);
            } else if (result.command != undefined) {
                
            } else {
                alert("There are no any answer. Try another request");
            }
        });
    },
    
    /**
     * Initiate user natural language command
     * @param {String} query Natural language query
     */
    doTextCommand: function(query) {
        SCWeb.core.Server.textCommand(query, function(result) {
            if (result.question != undefined) {
                SCWeb.ui.WindowManager.appendHistoryItem(result.question);
            } else if (result.command != undefined) {

            } else {
                alert("There are no any answer. Try another request");
            }
        });
    },
    
    /**
     * Initiate default user interface command
     * @param {Array} cmd_args Array of sc-addrs with command arguments
     */
    doDefaultCommand: function(cmd_args) {
        if (!this.default_cmd) {
            var self = this;
            SCWeb.core.Server.resolveScAddr([this.default_cmd_str], function(addrs) {
                self.default_cmd = addrs[self.default_cmd_str];
                if (self.default_cmd) {
                    self.doCommand(self.default_cmd, cmd_args);
                }
            });
        } else {
            this.doCommand(this.default_cmd, cmd_args);
        }
    }
    
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="SCWeb.core.Arguments.html">Arguments</a></li><li><a href="SCWeb.core.ComponentManager.html">ComponentManager</a></li><li><a href="SCWeb.core.ComponentSandbox.html">ComponentSandbox</a></li><li><a href="SCWeb.core.Debug.html">Debug</a></li><li><a href="SCWeb.core.EventManager.html">EventManager</a></li><li><a href="SCWeb.core.Main.html">Main</a></li><li><a href="SCWeb.core.Server.html">Server</a></li><li><a href="SCWeb.core.Translation.html">Translation</a></li></ul><h3>Namespaces</h3><ul><li><a href="SCWeb.html">SCWeb</a></li><li><a href="SCWeb.core.html">core</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Thu May 05 2016 20:53:04 GMT+0300 (Беларусь (зима))
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
